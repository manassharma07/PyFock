
  Memory set to 111.759 GiB by Python driver.
  Threads set to 4 by Python driver.

Scratch directory: /tmp/

*** tstart() called on baldr
*** at Thu Mar 30 10:43:29 2023

   => Loading Basis Set <=

    Name: DEF2-SVP
    Role: ORBITAL
    Keyword: BASIS
    atoms 1-10  entry C          line    90 file /home/manas/psi4conda/share/psi4/basis/def2-svp.gbs 
    atoms 11-32 entry H          line    15 file /home/manas/psi4conda/share/psi4/basis/def2-svp.gbs 


         ---------------------------------------------------------
                                   SCF
               by Justin Turney, Rob Parrish, Andy Simmonett
                          and Daniel G. A. Smith
                              RKS Reference
                        4 Threads, 114440 MiB Core
         ---------------------------------------------------------

  ==> Geometry <==

    Molecular point group: c1
    Full point group: C1

    Geometry (in Angstrom), charge = 0, multiplicity = 1:

       Center              X                  Y                   Z               Mass       
    ------------   -----------------  -----------------  -----------------  -----------------
         C            0.660900000000     0.387900000000     0.066100000000    12.000000000000
         C           -0.642900000000    -0.416100000000     0.097200000000    12.000000000000
         C            1.914100000000    -0.489400000000     0.024000000000    12.000000000000
         C           -1.896200000000     0.462500000000     0.063500000000    12.000000000000
         C            3.185800000000     0.361800000000     0.007100000000    12.000000000000
         C           -3.199200000000    -0.343000000000     0.034200000000    12.000000000000
         C            4.438100000000    -0.511000000000    -0.073500000000    12.000000000000
         C           -4.449800000000     0.530500000000    -0.074800000000    12.000000000000
         C            5.705000000000     0.329500000000    -0.056800000000    12.000000000000
         C           -5.715800000000    -0.312900000000    -0.087000000000    12.000000000000
         H            0.654500000000     1.046100000000    -0.811600000000     1.007825032230
         H            0.700300000000     1.037900000000     0.949000000000     1.007825032230
         H           -0.661800000000    -1.040700000000     0.998600000000     1.007825032230
         H           -0.661600000000    -1.098500000000    -0.761600000000     1.007825032230
         H            1.926200000000    -1.154000000000     0.896400000000     1.007825032230
         H            1.883700000000    -1.126300000000    -0.868200000000     1.007825032230
         H           -1.899000000000     1.124300000000     0.938300000000     1.007825032230
         H           -1.856400000000     1.108400000000    -0.822400000000     1.007825032230
         H            3.160900000000     1.045500000000    -0.850300000000     1.007825032230
         H            3.224700000000     0.980000000000     0.912300000000     1.007825032230
         H           -3.172100000000    -1.037400000000    -0.814900000000     1.007825032230
         H           -3.260200000000    -0.955900000000     0.942100000000     1.007825032230
         H            4.460200000000    -1.209400000000     0.771100000000     1.007825032230
         H            4.415400000000    -1.111100000000    -0.990500000000     1.007825032230
         H           -4.488700000000     1.228900000000     0.769100000000     1.007825032230
         H           -4.405200000000     1.129900000000    -0.991300000000     1.007825032230
         H            6.587900000000    -0.314500000000    -0.116200000000     1.007825032230
         H            5.774200000000     0.916700000000     0.864500000000     1.007825032230
         H            5.729400000000     1.019000000000    -0.906700000000     1.007825032230
         H           -6.598200000000     0.329900000000    -0.165500000000     1.007825032230
         H           -5.720200000000    -1.001500000000    -0.937900000000     1.007825032230
         H           -5.804400000000    -0.900800000000     0.832000000000     1.007825032230

  Running in c1 symmetry.

  Rotational constants: A =      0.27746  B =      0.00854  C =      0.00842 [cm^-1]
  Rotational constants: A =   8317.92634  B =    256.11506  C =    252.51420 [MHz]
  Nuclear repulsion =  519.138466611392801

  Charge       = 0
  Multiplicity = 1
  Electrons    = 82
  Nalpha       = 41
  Nbeta        = 41

  ==> Algorithm <==

  SCF Algorithm Type is DF.
  DIIS enabled.
  MOM disabled.
  Fractional occupation disabled.
  Guess Type is SAD.
  Energy threshold   = 1.00e-07
  Density threshold  = 1.00e-06
  Integral threshold = 1.00e-12

  ==> Primary Basis <==

  Basis Set: DEF2-SVP
    Blend: DEF2-SVP
    Number of shells: 126
    Number of basis functions: 260
    Number of Cartesian functions: 260
    Spherical Harmonics?: false
    Max angular momentum: 2

  ==> DFT Potential <==

   => Composite Functional: LDA,VWN5 <= 

    Slater exchange
    Vosko, Wilk & Nusair (VWN5)
    P. A. M. Dirac, Math. Proc. Cambridge Philos. Soc. 26, 376 (1930) (10.1017/S0305004100016108)
    F. Bloch, Z. Phys. 57, 545 (1929) (10.1007/BF01340281)
    S. H. Vosko, L. Wilk, and M. Nusair, Can. J. Phys. 58, 1200 (1980) (10.1139/p80-159)

    Deriv               =              1
    GGA                 =          FALSE
    Meta                =          FALSE

    Exchange Hybrid     =          FALSE
    MP2 Hybrid          =          FALSE

   => Exchange Functionals <=

    1.0000         XC_LDA_X

   => Correlation Functionals <=

    1.0000     XC_LDA_C_VWN

   => LibXC Density Thresholds  <==

    XC_LDA_C_VWN:  1.00E-15 
    XC_LDA_X:  1.00E-15 

   => Molecular Quadrature <=

    Radial Scheme          =       TREUTLER
    Pruning Scheme         =         ROBUST
    Pruning Type           =         REGION
    Nuclear Scheme         =       TREUTLER

    Blocking Scheme        =         OCTREE
    BS radius alpha        =              1
    Pruning alpha          =              1
    Radial Points          =             80
    Spherical Points       =            590
    Total Points           =         971794
    Total Blocks           =           6633
    Max Points             =            256
    Max Functions          =            185
    Weights Tolerance      =       1.00E-15

   => Loading Basis Set <=

    Name: DEF2-UNIVERSAL-JFIT
    Role: JKFIT
    Keyword: DF_BASIS_SCF
    atoms 1-10  entry C          line   170 file /home/manas/psi4conda/share/psi4/basis/def2-universal-jfit.gbs 
    atoms 11-32 entry H          line    17 file /home/manas/psi4conda/share/psi4/basis/def2-universal-jfit.gbs 

  ==> Integral Setup <==

  DFHelper Memory: AOs need 0.339 GiB; user supplied 82.916 GiB. Using in-core AOs.

  ==> MemDFJK: Density-Fitted J/K Matrices <==

    J tasked:                   Yes
    K tasked:                    No
    wK tasked:                   No
    OpenMP threads:               4
    Memory [MiB]:             84905
    Algorithm:                 Core
    Schwarz Cutoff:           1E-12
    Mask sparsity (%):      29.8609
    Fitting Condition:        1E-10

   => Auxiliary Basis Set <=

  Basis Set: DEF2-UNIVERSAL-JFIT
    Blend: DEF2-UNIVERSAL-JFIT
    Number of shells: 260
    Number of basis functions: 874
    Number of Cartesian functions: 874
    Spherical Harmonics?: false
    Max angular momentum: 4

  Cached 100.0% of DFT collocation blocks in 0.903 [GiB].

  Minimum eigenvalue in the overlap matrix is 8.4935376352E-04.
  Reciprocal condition number of the overlap matrix is 9.6868990936E-05.
    Using symmetric orthogonalization.

  ==> Pre-Iterations <==

  SCF Guess: Superposition of Atomic Densities via on-the-fly atomic UHF (no occupation information).

   -------------------------
    Irrep   Nso     Nmo    
   -------------------------
     A        260     260 
   -------------------------
    Total     260     260
   -------------------------

  ==> Iterations <==

                           Total Energy        Delta E     RMS |[F,P]|

   @DF-RKS iter SAD:  -389.47132819044680   -3.89471e+02   0.00000e+00 
   @DF-RKS iter   1:  -388.71323068139196    7.58098e-01   6.46303e-03 DIIS
   @DF-RKS iter   2:  -386.38846208762925    2.32477e+00   9.87398e-03 DIIS
   @DF-RKS iter   3:  -390.30210131870547   -3.91364e+00   5.32500e-04 DIIS
   @DF-RKS iter   4:  -390.30703579204658   -4.93447e-03   4.42900e-04 DIIS
   @DF-RKS iter   5:  -390.31338740102638   -6.35161e-03   9.29768e-05 DIIS
   @DF-RKS iter   6:  -390.31365870819593   -2.71307e-04   2.19606e-05 DIIS
   @DF-RKS iter   7:  -390.31367257356260   -1.38654e-05   9.82741e-06 DIIS
   @DF-RKS iter   8:  -390.31367576876130   -3.19520e-06   1.30790e-06 DIIS
   @DF-RKS iter   9:  -390.31367582942710   -6.06658e-08   3.56003e-07 DIIS
  Energy and wave function converged.


  ==> Post-Iterations <==

   Electrons on quadrature grid:
      Ntotal   =   81.9999905316 ; deviation = -9.468e-06 

    Orbital Energies [Eh]
    ---------------------

    Doubly Occupied:                                                      

       1A     -9.794479     2A     -9.793862     3A     -9.792873  
       4A     -9.792757     5A     -9.792739     6A     -9.792722  
       7A     -9.792711     8A     -9.792663     9A     -9.787019  
      10A     -9.786454    11A     -0.728290    12A     -0.714141  
      13A     -0.689307    14A     -0.655840    15A     -0.614173  
      16A     -0.568699    17A     -0.526540    18A     -0.512135  
      19A     -0.504006    20A     -0.501809    21A     -0.436783  
      22A     -0.423180    23A     -0.400604    24A     -0.390932  
      25A     -0.383550    26A     -0.372255    27A     -0.370382  
      28A     -0.348690    29A     -0.340220    30A     -0.337203  
      31A     -0.316767    32A     -0.311056    33A     -0.296034  
      34A     -0.293348    35A     -0.289434    36A     -0.285915  
      37A     -0.280789    38A     -0.278010    39A     -0.275284  
      40A     -0.273551    41A     -0.255970  

    Virtual:                                                              

      42A      0.027580    43A      0.034167    44A      0.044371  
      45A      0.049590    46A      0.056194    47A      0.062902  
      48A      0.067252    49A      0.073063    50A      0.094371  
      51A      0.096440    52A      0.099577    53A      0.118826  
      54A      0.119243    55A      0.126961    56A      0.129249  
      57A      0.130799    58A      0.135844    59A      0.141393  
      60A      0.146258    61A      0.150320    62A      0.164434  
      63A      0.165082    64A      0.167190    65A      0.172919  
      66A      0.175251    67A      0.194770    68A      0.201226  
      69A      0.205245    70A      0.227222    71A      0.260147  
      72A      0.261026    73A      0.340033    74A      0.373525  
      75A      0.381545    76A      0.382770    77A      0.383392  
      78A      0.385173    79A      0.398558    80A      0.409049  
      81A      0.411667    82A      0.419903    83A      0.443634  
      84A      0.446830    85A      0.466373    86A      0.476407  
      87A      0.499473    88A      0.544356    89A      0.565785  
      90A      0.572223    91A      0.583186    92A      0.585299  
      93A      0.587644    94A      0.592106    95A      0.597452  
      96A      0.599947    97A      0.602891    98A      0.603986  
      99A      0.614339   100A      0.615883   101A      0.616525  
     102A      0.620254   103A      0.632640   104A      0.633595  
     105A      0.637516   106A      0.640219   107A      0.640608  
     108A      0.643364   109A      0.645013   110A      0.651763  
     111A      0.655451   112A      0.658066   113A      0.662535  
     114A      0.667345   115A      0.677020   116A      0.686364  
     117A      0.687549   118A      0.690511   119A      0.697186  
     120A      0.711673   121A      0.733406   122A      0.811617  
     123A      0.870400   124A      0.892459   125A      0.937399  
     126A      0.942886   127A      0.950644   128A      0.963615  
     129A      0.968818   130A      0.975763   131A      0.982481  
     132A      0.994985   133A      1.005985   134A      1.013563  
     135A      1.066660   136A      1.150644   137A      1.170234  
     138A      1.234200   139A      1.277107   140A      1.281600  
     141A      1.286651   142A      1.292382   143A      1.304621  
     144A      1.318734   145A      1.320822   146A      1.327655  
     147A      1.340622   148A      1.341784   149A      1.371034  
     150A      1.450851   151A      1.480133   152A      1.480332  
     153A      1.554986   154A      1.628866   155A      1.634966  
     156A      1.640068   157A      1.673724   158A      1.687971  
     159A      1.689562   160A      1.692411   161A      1.706287  
     162A      1.709131   163A      1.710857   164A      1.723638  
     165A      1.727995   166A      1.728562   167A      1.733464  
     168A      1.741026   169A      1.750045   170A      1.752358  
     171A      1.754302   172A      1.761690   173A      1.762866  
     174A      1.773697   175A      1.774736   176A      1.780029  
     177A      1.786672   178A      1.787327   179A      1.797342  
     180A      1.806899   181A      1.820520   182A      1.828269  
     183A      1.835289   184A      1.853278   185A      1.860283  
     186A      1.870467   187A      1.886309   188A      1.890675  
     189A      1.901187   190A      1.908163   191A      1.916793  
     192A      1.930560   193A      1.959666   194A      1.990574  
     195A      2.003447   196A      2.020051   197A      2.029638  
     198A      2.040714   199A      2.074429   200A      2.099641  
     201A      2.177181   202A      2.194856   203A      2.243141  
     204A      2.246417   205A      2.296424   206A      2.318491  
     207A      2.321310   208A      2.330347   209A      2.331554  
     210A      2.335058   211A      2.347463   212A      2.374198  
     213A      2.386379   214A      2.387798   215A      2.409969  
     216A      2.440683   217A      2.450109   218A      2.460824  
     219A      2.493034   220A      2.500175   221A      2.501955  
     222A      2.518202   223A      2.529433   224A      2.534451  
     225A      2.535870   226A      2.563604   227A      2.584978  
     228A      2.602181   229A      2.691944   230A      2.741296  
     231A      2.766889   232A      2.783098   233A      2.789096  
     234A      2.796243   235A      2.816617   236A      2.832731  
     237A      2.838551   238A      2.872531   239A      2.879569  
     240A      2.892246   241A      2.899354   242A      2.931506  
     243A      2.957909   244A      2.971203   245A      2.989907  
     246A      3.014970   247A      3.017611   248A      3.027441  
     249A      3.048797   250A      3.049532   251A      4.935576  
     252A      4.974381   253A      5.027073   254A      5.087190  
     255A      5.146909   256A      5.206312   257A      5.265162  
     258A      5.316708   259A      5.355589   260A      5.382833  

    Final Occupation by Irrep:
              A 
    DOCC [    41 ]
    NA   [    41 ]
    NB   [    41 ]

  @DF-RKS Final Energy:  -390.31367582942710

   => Energetics <=

    Nuclear Repulsion Energy =            519.1384666113928006
    One-Electron Energy =               -1557.1279115342995283
    Two-Electron Energy =                 706.0757737506997955
    DFT Exchange-Correlation Energy =     -58.4000046572200446
    Empirical Dispersion Energy =           0.0000000000000000
    VV10 Nonlocal Energy =                  0.0000000000000000
    Total Energy =                       -390.3136758294270976

Computation Completed


Properties will be evaluated at   0.000000,   0.000000,   0.000000 [a0]

Properties computed using the SCF density matrix


 Multipole Moments:

 ------------------------------------------------------------------------------------
     Multipole            Electronic (a.u.)      Nuclear  (a.u.)        Total (a.u.)
 ------------------------------------------------------------------------------------

 L = 1.  Multiply by 2.5417464519 to convert [e a0] to [Debye]
 Dipole X            :          0.0217335           -0.0196532            0.0020803
 Dipole Y            :         -0.0294593            0.0289128           -0.0005464
 Dipole Z            :          0.3104766           -0.3093482            0.0011284
 Magnitude           :                                                    0.0024289

 ------------------------------------------------------------------------------------

*** tstop() called on baldr at Thu Mar 30 10:43:41 2023
Module time:
	user time   =      45.32 seconds =       0.76 minutes
	system time =       0.58 seconds =       0.01 minutes
	total time  =         12 seconds =       0.20 minutes
Total time:
	user time   =      45.32 seconds =       0.76 minutes
	system time =       0.58 seconds =       0.01 minutes
	total time  =         12 seconds =       0.20 minutes
Operating System: Linux 5.13.0-44-generic
System Type: 64bit
CPU Model: AMD Ryzen Threadripper 3990X 64-Core Processor
Number of Cores: 64
Number of Threads: 128
Memory (GB): 125.661865234375
Number of cores being actually used/requested for the benchmark: 4
Confirming that the environment variables are properly set...
OMP_NUM_THREADS = 4
OPENBLAS_NUM_THREADS = 4
MKL_NUM_THREADS = 4
VECLIB_MAXIMUM_THREADS = 4
NUMEXPR_NUM_THREADS = 4
PYSCF_MAX_MEMORY = 120000
Psi4 Grid Size:  (971794,)
#INFO: **** input file is /home/manas/temp_pyfock/PyFock/benchmarks_tests/psi4_pyscf_pyfock_DFT_DF_LDA.py ****
#DFT SCF benchmark and comparison with PySCF and Psi4
# Benchmarking accuracy and performance using various techniques and different softwares
import os

ncores = 4
max_memory = 120000

os.environ['OMP_NUM_THREADS'] = str(ncores)
os.environ["OPENBLAS_NUM_THREADS"] = str(ncores) # export OPENBLAS_NUM_THREADS=4
os.environ["MKL_NUM_THREADS"] = str(ncores) # export MKL_NUM_THREADS=4
os.environ["VECLIB_MAXIMUM_THREADS"] = str(ncores) # export VECLIB_MAXIMUM_THREADS=4
os.environ["NUMEXPR_NUM_THREADS"] = str(ncores) # export NUMEXPR_NUM_THREADS=4
# Set the max memory for PySCF
os.environ["PYSCF_MAX_MEMORY"] = str(max_memory)

# Print system information 
from pyfock import Utils
Utils.print_sys_info()

# Check if the environment variables are properly set
print("Number of cores being actually used/requested for the benchmark:", ncores)
print('Confirming that the environment variables are properly set...')
print('OMP_NUM_THREADS =', os.environ.get('OMP_NUM_THREADS', None))
print('OPENBLAS_NUM_THREADS =', os.environ.get('OPENBLAS_NUM_THREADS', None))
print('MKL_NUM_THREADS =', os.environ.get('MKL_NUM_THREADS', None))
print('VECLIB_MAXIMUM_THREADS =', os.environ.get('VECLIB_MAXIMUM_THREADS', None))
print('NUMEXPR_NUM_THREADS =', os.environ.get('NUMEXPR_NUM_THREADS', None))
print('PYSCF_MAX_MEMORY =', os.environ.get('PYSCF_MAX_MEMORY', None))

from timeit import default_timer as timer

radial_points = 80
spherical_points = 590

#funcpsi4 = "svwn"
funcpyscf = "LDA_X, LDA_C_VWN" #'1,7'
funcx = 1 #LDA_X
funcc = 7 #LDA_C_VWN
funccrysx = [funcx, funcc]
funcpsi4 = {
    "name": "LDA,VWN5",
    "x_functionals": {"LDA_X":{}},
    "c_functionals": {"LDA_C_VWN": {}}
}

# basis_set_name = 'sto-2g'
# basis_set_name = 'sto-3g'
# basis_set_name = 'sto-6g'
# basis_set_name = '6-31G'
basis_set_name = 'def2-SVP'
# basis_set_name = 'def2-DZVP'
# basis_set_name = 'def2-TZVP'
# basis_set_name = 'def2-TZVPP'
# basis_set_name = 'def2-TZVPPD'
# basis_set_name = 'def2-QZVPPD'
# basis_set_name = 'cc-pVDZ'
# basis_set_name = 'ano-rcc'

auxbasis_name = 'def2-universal-jfit'
# auxbasis_name = 'sto-3g'
# auxbasis_name = 'def2-SVP'
# auxbasis_name = '6-31G'

# xyzFilename = 'Benzene-Fulvene_Dimer.xyz'
# xyzFilename = 'Adenine-Thymine.xyz'
# xyzFilename = 'Zn.xyz'
# xyzFilename = 'Zn_dimer.xyz'
# xyzFilename = 'TPP.xyz'
# xyzFilename = 'Zn_TPP.xyz'
# xyzFilename = 'h2o.xyz'
# xyzFilename = 'Ethane.xyz'
# xyzFilename = 'Cholesterol.xyz'
# xyzFilename = 'Serotonin.xyz'
# xyzFilename = 'Decane_C10H22.xyz'
# xyzFilename = 'Icosane_C20H42.xyz'
xyzFilename = 'Tetracontane_C40H82.xyz'
# xyzFilename = 'Pentacontane_C50H102.xyz'
# xyzFilename = 'Octacontane_C80H162.xyz'
# xyzFilename = 'Hectane_C100H202.xyz'
# xyzFilename = 'Icosahectane_C120H242.xyz'

###############-----------------PSI4-----------------###############

import psi4
psi4.set_memory(int(max_memory*1e6))
numpy_memory = 80
import numpy as np

#psi4_geo = psi4.geometry(geo_txt)
with open(xyzFilename,"r") as f:
    xyz_string = f.read()

psi4_geo = psi4.core.Molecule.from_string(xyz_string, dtype='xyz',fix_symmetry='c1', fix_orientation=True,fix_com=True)

# run psi4 calculation
psi4.core.set_num_threads(ncores)
psi4.set_options(
    {
        "scf__reference": "rks",
        "scf_type": "df",
        "scf__maxiter": 50,
        "basis": basis_set_name,
        "df_basis_scf": auxbasis_name,
        "puream":False,
        "guess": "sad",
        "SCF_INITIAL_ACCELERATOR":"none",
        "dft_spherical_points":spherical_points,
        "dft_radial_points" :radial_points,
        "dft_pruning_scheme": "robust",
        "diis_max_vecs" : 8,
        #"DFT_NUCLEAR_SCHEME":"becke",
        "E_CONVERGENCE":1e-7,
    }
)
energy_psi4, wfn = psi4.energy(name="scf",dft_functional=funcpsi4, molecule=psi4_geo, return_wfn=True)
basis = wfn.basisset()

# Get grid points that were used by psi4 calculation
functional = psi4.driver.dft.build_superfunctional(funcpsi4, True)[0] # True states that we're working with a restricted system
Vpot       = psi4.core.VBase.build(basis, functional, "RV")         # This object contains different methods associated with DFT methods and the grid.
                                                                    # "RV" states that this is a restricted system consystent with 'functional'
Vpot.initialize() # We initialize the object

# The grid (and weights) can then be extracted from Vpot.
x, y, z, weights_psi4 = Vpot.get_np_xyzw()
Vpot = 0 # Get rid of unnecessary stuff
#print(x.shape)
#print(y.shape)
#print(z.shape)
#print(weights_psi4.shape)

# Combine the arrays into a single 2D array
points = np.column_stack((x, y, z))
# Get rid of unnecessary stuff
x=0 
y=0
z=0
wfn = 0
print('Psi4 Grid Size: ', weights_psi4.shape)



###############-----------------PySCF-----------------###############
import pyscf
from pyscf import dft, gto
# run PySCF calculation
mol = gto.M(
    atom=xyzFilename,  # just removing the last line that was only for psi4
    basis=basis_set_name,
    symmetry=False,
    verbose=4,
    cart=True,
)


mf = dft.rks.RKS(mol, xc=funcpyscf).density_fit(auxbasis=auxbasis_name)
mf.init_guess = 'minao'
dmat_init = mf.init_guess_by_minao(mol)
mf.grids.level = 5
mf.verbose = 4
# mf.grids.prune = None
# mf.grids.atom_grid = (radial_points, spherical_points)
# mf.grids.build()
# mf.grids.becke_scheme = dft.gen_grid.stratmann
# mf.small_rho_cutoff = 1e-15
#mf.grids.coords = points
#print('Check to see if using psi4 grids worked or not?', mf.grids.coords.shape)
#mf.grids.weights = weights_psi4
#print('Check to see if using psi4 grids worked or not?', mf.grids.weights.shape)
mf.conv_tol = 1e-7
start=timer()
energy_pyscf = mf.kernel()
duration = timer()-start
print('PySCF time: ', duration)
pyscfGrids = mf.grids
print(mf.grids.coords.shape)
print('Nuc-Nuc PySCF= ', mol.energy_nuc())
print('One electron integrals energy',mf.scf_summary['e1'])
print('Coulomb energy ',mf.scf_summary['coul'])
print('EXC ',mf.scf_summary['exc'])
print('Energy diff (Pyscf-Psi4)', abs(energy_pyscf-energy_psi4))
print('PySCF Grid Size: ', pyscfGrids.weights.shape)
# Get rid of unnecessary stuff
mf = 0
weights_psi4 = 0




###############-----------------PyFOCK-----------------###############
from pyfock import Basis
from pyfock import Mol
from pyfock import Integrals
from pyfock import DFT



#Initialize a Mol object with somewhat large geometry
molCrysX = Mol(coordfile=xyzFilename)


#Initialize a Basis object with a very large basis set
basis = Basis(molCrysX, {'all':Basis.load(mol=molCrysX, basis_name=basis_set_name)})
print('\n\nNAO :',basis.bfs_nao)

auxbasis = Basis(molCrysX, {'all':Basis.load(mol=molCrysX, basis_name=auxbasis_name)})
print('\n\naux NAO :',auxbasis.bfs_nao)

dftObj = DFT(molCrysX, basis, xc=funccrysx)
#dftObj.diisSpace = 8
# Using PySCF/Psi4 grids to compare the energies
energy_crysX, dmat = dftObj.scf(max_itr=30, ncores=ncores, dmat=dmat_init, grids=pyscfGrids, isDF=True, auxbasis=auxbasis, rys=True, DF_algo=6, blocksize=5000, XC_algo=2, debug=False, sortGrids=False, save_ao_values=True, threshold_schwarz=1e-09)
# Using CrysX grids 
# To get the same energies as PySCF (level=5) upto 1e-7 au, use the following settings
# radial_precision=1.0e-13
# level=3
# pruning by density with threshold = 1e-011
# alpha_min and alpha_max corresponding to QZVP
# energyCrysX, dmat = dftObj.scf(max_itr=30, ncores=ncores, dmat=dmat_init, grids=None, gridsLevel=3, isDF=True, auxbasis=auxbasis, rys=True, DF_algo=6, blocksize=5000, XC_algo=2, debug=False, sortGrids=True, save_ao_values=False)



print('Energy diff (PySCF-CrysX)', abs(energy_crysX-energy_pyscf))
print('Energy diff (Psi4-CrysX)', abs(energy_crysX-energy_psi4))



#Print package versions
import joblib
import scipy
import numba
import threadpoolctl
import opt_einsum
import pylibxc
import llvmlite 
print('\n\n\n Package versions')
print('pyscf version', pyscf.__version__)
print('psi4 version', psi4.__version__)
print('np version', np.__version__)
print('joblib version', joblib.__version__)
print('numba version', numba.__version__)
print('threadpoolctl version', threadpoolctl.__version__)
print('opt_einsum version', opt_einsum.__version__)
# print('pylibxc version', pylibxc.__version__)
print('llvmlite version', llvmlite.__version__)



print('\n\n\n Numpy Config')
print(np.show_config())
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='baldr', release='5.13.0-44-generic', version='#49~20.04.1-Ubuntu SMP Wed May 18 18:44:28 UTC 2022', machine='x86_64', processor='x86_64')  Threads 4
Python 3.8.15 (default, Nov 24 2022, 15:19:38) 
[GCC 11.2.0]
numpy 1.21.6  scipy 1.7.3
Date: Thu Mar 30 10:43:43 2023
PySCF version 2.1.1
PySCF path  /home/manas/.local/lib/python3.8/site-packages/pyscf
GIT HEAD      /home/manas/.local/lib/python3.8/site-packages/pyscf/.git/HEAD

[ENV] PYSCF_MAX_MEMORY 120000
[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 32
[INPUT] num. electrons = 82
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Cartesian GTO integrals (6d 10f)
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 C      0.660900000000   0.387900000000   0.066100000000 AA    1.248919995725   0.733024763719   0.124910896834 Bohr   0.0
[INPUT]  2 C     -0.642900000000  -0.416100000000   0.097200000000 AA   -1.214904925483  -0.786315040432   0.183681379308 Bohr   0.0
[INPUT]  3 C      1.914100000000  -0.489400000000   0.024000000000 AA    3.617124775030  -0.924831965362   0.045353426990 Bohr   0.0
[INPUT]  4 C     -1.896200000000   0.462500000000   0.063500000000 AA   -3.583298677400   0.873998332611   0.119997608910 Bohr   0.0
[INPUT]  5 C      3.185800000000   0.361800000000   0.007100000000 AA    6.020289487639   0.683702911868   0.013417055484 Bohr   0.0
[INPUT]  6 C     -3.199200000000  -0.343000000000   0.034200000000 AA   -6.045611817709  -0.648176060726   0.064628633460 Bohr   0.0
[INPUT]  7 C      4.438100000000  -0.511000000000  -0.073500000000 AA    8.386793513432  -0.965650049653  -0.138894870156 Bohr   0.0
[INPUT]  8 C     -4.449800000000   0.530500000000  -0.074800000000 AA   -8.408903309090   1.002499709082  -0.141351514117 Bohr   0.0
[INPUT]  9 C      5.705000000000   0.329500000000  -0.056800000000 AA   10.780887540644   0.622664758044  -0.107336443875 Bohr   0.0
[INPUT] 10 C     -5.715800000000  -0.312900000000  -0.087000000000 AA  -10.801296582789  -0.591295304376  -0.164406172837 Bohr   0.0
[INPUT] 11 H      0.654500000000   1.046100000000  -0.811600000000 AA    1.236825748528   1.976842498908  -1.533701722697 Bohr   0.0
[INPUT] 12 H      0.700300000000   1.037900000000   0.949000000000 AA    1.323375205033   1.961346744686   1.793350092212 Bohr   0.0
[INPUT] 13 H     -0.661800000000  -1.040700000000   0.998600000000 AA   -1.250620749237  -1.966637977835   1.887080507991 Bohr   0.0
[INPUT] 14 H     -0.661600000000  -1.098500000000  -0.761600000000 AA   -1.250242804012  -2.075864147835  -1.439215416469 Bohr   0.0
[INPUT] 15 H      1.926200000000  -1.154000000000   0.896400000000 AA    3.639990461137  -2.180743947748   1.693950498060 Bohr   0.0
[INPUT] 16 H      1.883700000000  -1.126300000000  -0.868200000000 AA    3.559677100843  -2.128398534098  -1.640660221347 Bohr   0.0
[INPUT] 17 H     -1.899000000000   1.124300000000   0.938300000000 AA   -3.588589910549   2.124619081848   1.773130022679 Bohr   0.0
[INPUT] 18 H     -1.856400000000   1.108400000000  -0.822400000000 AA   -3.508087577643   2.094572436468  -1.554110764842 Bohr   0.0
[INPUT] 19 H      3.160900000000   1.045500000000  -0.850300000000 AA    5.973235307138   1.975708663233  -1.606834123718 Bohr   0.0
[INPUT] 20 H      3.224700000000   0.980000000000   0.912300000000 AA    6.093799833885   1.851931602074   1.723997143441 Bohr   0.0
[INPUT] 21 H     -3.172100000000  -1.037400000000  -0.814900000000 AA   -5.994400239733  -1.960401881624  -1.539937818908 Bohr   0.0
[INPUT] 22 H     -3.260200000000  -0.955900000000   0.942100000000 AA   -6.160885111307  -1.806389202472   1.780310981953 Bohr   0.0
[INPUT] 23 H      4.460200000000  -1.209400000000   0.771100000000 AA    8.428556460785  -2.285434775049   1.457167814652 Bohr   0.0
[INPUT] 24 H      4.415400000000  -1.111100000000  -0.990500000000 AA    8.343896730405  -2.099674697004  -1.871773726382 Bohr   0.0
[INPUT] 25 H     -4.488700000000   1.228900000000   0.769100000000 AA   -8.482413655335   2.322284434478   1.453388362403 Bohr   0.0
[INPUT] 26 H     -4.405200000000   1.129900000000  -0.991300000000 AA   -8.324621523934   2.135201548146  -1.873285507281 Bohr   0.0
[INPUT] 27 H      6.587900000000  -0.314500000000  -0.116200000000 AA   12.449326736022  -0.594318866176  -0.219586175674 Bohr   0.0
[INPUT] 28 H      5.774200000000   0.916700000000   0.864500000000 AA   10.911656588464   1.732311938389   1.633668234686 Bohr   0.0
[INPUT] 29 H      5.729400000000   1.019000000000  -0.906700000000 AA   10.826996858083   1.925630920932  -1.713414677143 Bohr   0.0
[INPUT] 30 H     -6.598200000000   0.329900000000  -0.165500000000 AA  -12.468790915105   0.623420648494  -0.312749673616 Bohr   0.0
[INPUT] 31 H     -5.720200000000  -1.001500000000  -0.937900000000 AA  -10.809611377737  -1.892560713752  -1.772374132230 Bohr   0.0
[INPUT] 32 H     -5.804400000000  -0.900800000000   0.832000000000 AA  -10.968726317425  -1.702265293008   1.572252135638 Bohr   0.0

nuclear repulsion = 519.13846685665
number of shells = 126
number of NR pGTOs = 404
number of NR cGTOs = 260
basis = def2-SVP
ecp = {}
CPU time:        55.32


******** <class 'pyscf.df.df_jk.density_fit.<locals>.DensityFitting'> ********
method = DensityFitting-RKS
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-07
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/manas/temp_pyfock/PyFock/benchmarks_tests/tmprl0e__13
max_memory 120000 MB (current use 1566 MB)
XC library pyscf.dft.libxc version 5.2.0
    S. Lehtola, C. Steigemann, M. J. Oliveira, and M. A. Marques, SoftwareX 7, 1 (2018)
XC functionals = LDA_X, LDA_C_VWN
    P. A. M. Dirac, Math. Proc. Cambridge Philos. Soc. 26, 376 (1930)
    F. Bloch, Z. Phys. 57, 545 (1929)
    S. H. Vosko, L. Wilk, and M. Nusair, Can. J. Phys. 58, 1200 (1980)
radial grids: 
    Treutler-Ahlrichs [JCP 102, 346 (1995); DOI:10.1063/1.469408] (M4) radial grids
    
becke partition: Becke, JCP 88, 2547 (1988); DOI:10.1063/1.454033
pruning grids: <function nwchem_prune at 0x7fda0d29d9d0>
grids dens level: 5
symmetrized grids: False
atomic radii adjust function: <function treutler_atomic_radii_adjust at 0x7fda0d29d940>
small_rho_cutoff = 1e-07
Set gradient conv threshold to 0.000316228
tot grids = 949080
init E= -390.352492005006
  HOMO = -0.35992156552923  LUMO = -0.0186056383803001
cycle= 1 E= -390.102822428385  delta_E= 0.25  |g|= 0.842  |ddm|= 5.63
  HOMO = -0.12115481134787  LUMO = 0.0731789476053173
cycle= 2 E= -389.8266601354  delta_E= 0.276  |g|= 1.32  |ddm|= 2.63
  HOMO = -0.259942809376569  LUMO = 0.0275844112028352
cycle= 3 E= -390.3127066326  delta_E= -0.486  |g|= 0.0608  |ddm|= 1.72
  HOMO = -0.256445124861443  LUMO = 0.0276831883313247
cycle= 4 E= -390.313503560347  delta_E= -0.000797  |g|= 0.0235  |ddm|= 0.0986
  HOMO = -0.256044669330055  LUMO = 0.0276460871382533
cycle= 5 E= -390.313625471566  delta_E= -0.000122  |g|= 0.00763  |ddm|= 0.0298
  HOMO = -0.255999194813995  LUMO = 0.0275641467384886
cycle= 6 E= -390.313639640604  delta_E= -1.42e-05  |g|= 0.00127  |ddm|= 0.00973
  HOMO = -0.255950929412808  LUMO = 0.0275786855227972
cycle= 7 E= -390.313640006752  delta_E= -3.66e-07  |g|= 0.000511  |ddm|= 0.00204
  HOMO = -0.255967144471968  LUMO = 0.0275672725694447
cycle= 8 E= -390.313640068016  delta_E= -6.13e-08  |g|= 0.000109  |ddm|= 0.000605
  HOMO = -0.255963630170007  LUMO = 0.0275649383988246
Extra cycle  E= -390.313640066303  delta_E= 1.71e-09  |g|= 0.000138  |ddm|= 0.000355
converged SCF energy = -390.313640066303
OMP: Info #276: omp_set_nested routine deprecated, please use omp_set_max_active_levels instead.
PySCF time:  33.623754132539034
(773720, 3)
Nuc-Nuc PySCF=  519.1384668566502
One electron integrals energy -1557.1283702444343
Coulomb energy  706.0763449959155
EXC  -58.400081674434695
Energy diff (Pyscf-Psi4) 3.576312383302138e-05
PySCF Grid Size:  (773720,)


NAO : 260


aux NAO : 874
Running DFT using 4 threads for Numba.



Calculating one electron integrals...


Core H size in GB  0.0005408
done!
Time taken 0.3787440210580826 seconds.


Calculating three centered two electron and two-centered two-electron integrals...




Performing Schwarz screening...
Threshold  1e-09
Size of permanent array storing the significant indices of 3c2e ERI in GB  0.113265108
No. of elements in the standard three-centered two electron ERI tensor:  59082400
No. of elements in the triangular three-centered two electron ERI tensor:  29654820
No. of significant triplets based on Schwarz inequality and triangularity: 18877518 or 32.0% of original
Schwarz screening done!
Time taken 0.354523953050375 seconds.

Two Center Two electron ERI size in GB  0.006111008
Three Center Two electron ERI size in GB  0.151020144
Three-centered two electron evaluation done!
Time taken 13.937443520873785 seconds.


Using the user supplied grids!



No. of supplied/generated grid points:  773720
Size (in GB) for storing the coordinates of grid:       0.01856928
Size (in GB) for storing the weights of grid:           0.00618976
Size (in GB) for storing the density at gridpoints:     0.00618976

Will use batching to evaluate the XC term for memory efficiency.
Batch size:  5000
No. of batches:  154

Preliminary processing for XC term evaluations...
Calculating the value of basis functions (atomic orbitals) and get the indices of siginificantly contributing functions...
done!
Time taken 0.24166860058903694 seconds.

Maximum no. of basis functions contributing to a batch of grid points:    160
Average no. of basis functions contributing to a batch of grid points:    124

You have asked to save the values of significant basis functions on grid points so as to avoid recalculation for each SCF cycle.
Please note: This will require addtional memory that is approximately :0.7 GB
Calculating the value of significantly contributing basis functions (atomic orbitals)...
done!
Time taken 0.8892411887645721 seconds.



------------------------------------------------------
Exchange-Correlation Functional
------------------------------------------------------

XC Functional IDs supplied:  [1, 7]


Description of exchange functional: 

The Exchange function belongs to the family: LDA
Functional ID: 1
Functional Name: lda_x
Attributes:
    Name: Slater exchange
    Kind: 0
  Family: 1
Citations:
   P. A. M. Dirac, Math. Proc. Cambridge Philos. Soc. 26, 376 (1930)
   F. Bloch, Z. Phys. 57, 545 (1929)


Description of correlation functional: 

 The Correlation function belongs to the family: LDA
Functional ID: 7
Functional Name: lda_c_vwn
Attributes:
    Name: Vosko, Wilk & Nusair (VWN5)
    Kind: 1
  Family: 1
Citations:
   S. H. Vosko, L. Wilk, and M. Nusair, Can. J. Phys. 58, 1200 (1980)
------------------------------------------------------




Number of electrons:  81.83533664775062



------Iteration 1--------


Energies
Electron-Nuclear Energy       -1941.8346874277217
Nuclear repulsion Energy      519.138504098578
Kinetic Energy                394.28711732655825
Coulomb Energy                696.2819738100679
Exchange-Correlation Energy   -58.05407949534356
-------------------------
Total Energy  -390.181171687861
-------------------------



Energy difference :  390.181171687861


Time taken for the previous iteration: 0.5365930199623108


Number of electrons:  82.0000008245592



------Iteration 2--------


Energies
Electron-Nuclear Energy       -1955.9299913963057
Nuclear repulsion Energy      519.138504098578
Kinetic Energy                388.21421552085366
Coulomb Energy                717.807439466934
Exchange-Correlation Energy   -59.29213359433809
-------------------------
Total Energy  -390.06196590427794
-------------------------



Energy difference :  0.11920578358308376


Time taken for the previous iteration: 0.5568536892533302


Number of electrons:  82.00000106916663



------Iteration 3--------


Energies
Electron-Nuclear Energy       -1917.7114352317767
Nuclear repulsion Energy      519.138504098578
Kinetic Energy                376.97889275713044
Coulomb Energy                688.9862449435523
Exchange-Correlation Energy   -57.17183231956767
-------------------------
Total Energy  -389.77962575208403
-------------------------



Energy difference :  0.2823401521939104


Time taken for the previous iteration: 0.59229876101017


Number of electrons:  82.00000089212774



------Iteration 4--------


Energies
Electron-Nuclear Energy       -1941.7280382141098
Nuclear repulsion Energy      519.138504098578
Kinetic Energy                384.25256065418944
Coulomb Energy                706.4411014884801
Exchange-Correlation Energy   -58.417049378991
-------------------------
Total Energy  -390.3129213518531
-------------------------



Energy difference :  0.533295599769076


Time taken for the previous iteration: 0.5133030936121941


Number of electrons:  82.00000090210905



------Iteration 5--------


Energies
Electron-Nuclear Energy       -1941.3151222998688
Nuclear repulsion Energy      519.138504098578
Kinetic Energy                384.15133028222124
Coulomb Energy                706.1166774098205
Exchange-Correlation Energy   -58.40488016399513
-------------------------
Total Energy  -390.3134906732445
-------------------------



Energy difference :  0.000569321391367339


Time taken for the previous iteration: 0.5100210420787334


Number of electrons:  82.00000089868571



------Iteration 6--------


Energies
Electron-Nuclear Energy       -1941.2743118161898
Nuclear repulsion Energy      519.138504098578
Kinetic Energy                384.12884206767706
Coulomb Energy                706.0952623306767
Exchange-Correlation Energy   -58.401923762431466
-------------------------
Total Energy  -390.3136270816898
-------------------------



Energy difference :  0.00013640844531437324


Time taken for the previous iteration: 0.5545086376369


Number of electrons:  82.00000090072159



------Iteration 7--------


Energies
Electron-Nuclear Energy       -1941.248932087687
Nuclear repulsion Energy      519.138504098578
Kinetic Energy                384.1173164004875
Coulomb Energy                706.0797526913548
Exchange-Correlation Energy   -58.40028067526471
-------------------------
Total Energy  -390.31363957253143
-------------------------



Energy difference :  1.2490841641010775e-05


Time taken for the previous iteration: 0.5303049683570862


Number of electrons:  82.00000089990766



------Iteration 8--------


Energies
Electron-Nuclear Energy       -1941.2446775459669
Nuclear repulsion Energy      519.138504098578
Kinetic Energy                384.1162950797235
Coulomb Energy                706.076341331092
Exchange-Correlation Energy   -58.40010295557918
-------------------------
Total Energy  -390.31363999215273
-------------------------



Energy difference :  4.1962130126194097e-07


Time taken for the previous iteration: 0.5469440557062626


Number of electrons:  82.00000089994423



------Iteration 9--------


Energies
Electron-Nuclear Energy       -1941.244780498981
Nuclear repulsion Energy      519.138504098578
Kinetic Energy                384.11623642866937
Coulomb Energy                706.0764778815175
Exchange-Correlation Energy   -58.40007795445618
-------------------------
Total Energy  -390.31364004467275
-------------------------



Energy difference :  5.252002210909268e-08

SCF Converged after 9 iterations!

-------------------------------------
Total Energy =  -390.31364004467275
-------------------------------------



Time taken : 20.31783266738057 seconds.



-------------------------------------
Profiling
-------------------------------------
Preprocessing                           1.485433742403984
Density Fitting                         0.4898674823343754
DIIS                                    0.10681310668587685
KS matrix diagonalization               0.06474338099360466
One electron Integrals (S, T, Vnuc)     0.3787440210580826
Coulomb Integrals                       13.58291956782341
Grids construction                      0
Exchange-Correlation Term               4.1986728347837925
Misc.                                   0.010638531297445297
Complete SCF                            20.31783266738057
Energy diff (PySCF-CrysX) 2.1630512492265552e-08
Energy diff (Psi4-CrysX) 3.578475434551365e-05



 Package versions
pyscf version 2.1.1
psi4 version 1.7
np version 1.21.6
joblib version 1.2.0
numba version 0.56.4
threadpoolctl version 3.1.0
opt_einsum version v3.3.0
llvmlite version 0.39.1



 Numpy Config
blas_mkl_info:
  NOT AVAILABLE
blis_info:
  NOT AVAILABLE
openblas_info:
    libraries = ['openblas', 'openblas']
    library_dirs = ['/usr/local/lib']
    language = c
    define_macros = [('HAVE_CBLAS', None)]
    runtime_library_dirs = ['/usr/local/lib']
blas_opt_info:
    libraries = ['openblas', 'openblas']
    library_dirs = ['/usr/local/lib']
    language = c
    define_macros = [('HAVE_CBLAS', None)]
    runtime_library_dirs = ['/usr/local/lib']
lapack_mkl_info:
  NOT AVAILABLE
openblas_lapack_info:
    libraries = ['openblas', 'openblas']
    library_dirs = ['/usr/local/lib']
    language = c
    define_macros = [('HAVE_CBLAS', None)]
    runtime_library_dirs = ['/usr/local/lib']
lapack_opt_info:
    libraries = ['openblas', 'openblas']
    library_dirs = ['/usr/local/lib']
    language = c
    define_macros = [('HAVE_CBLAS', None)]
    runtime_library_dirs = ['/usr/local/lib']
Supported SIMD extensions in this NumPy install:
    baseline = SSE,SSE2,SSE3
    found = SSSE3,SSE41,POPCNT,SSE42,AVX,F16C,FMA3,AVX2
    not found = AVX512F,AVX512CD,AVX512_KNL,AVX512_KNM,AVX512_SKX,AVX512_CLX,AVX512_CNL,AVX512_ICL
None
